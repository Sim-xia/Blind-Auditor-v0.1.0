# ğŸ›¡ï¸ Blind Auditor - MCP æœåŠ¡å™¨

> **"Code drunk, audit sober."** â€” *Blind Auditor å“²å­¦*

Blind Auditor æ˜¯ä¸€ä¸ªåŸºäº MCP (Model Context Protocol) åè®®æ„å»ºçš„**å¼ºåˆ¶æ€§ä»£ç å®¡è®¡ç³»ç»Ÿ**ã€‚å®ƒé€šè¿‡ç‹¬åˆ›çš„**"æ€ç»´éš”ç¦»" (Thinking Isolation)** æœºåˆ¶ï¼Œå¼ºåˆ¶ AI æ™ºèƒ½ä½“ (Agent) åœ¨è¾“å‡ºæœ€ç»ˆä»£ç å‰ï¼Œå¿…é¡»å…ˆè¿›å…¥ä¸€ä¸ªç‹¬ç«‹çš„"å®¡è®¡æ—¶ç©º"è¿›è¡Œè‡ªæˆ‘å®¡æŸ¥ã€‚

## ğŸ§  æ ¸å¿ƒç†å¿µï¼šæ€ç»´éš”ç¦»

ä¼ ç»Ÿçš„ AI ç¼–ç å¾€å¾€æ˜¯"ç”Ÿæˆå³è¾“å‡º"ï¼Œé”™è¯¯å’Œåè§å®¹æ˜“è¢«å¸¦å…¥ã€‚Blind Auditor å¼•å…¥äº†ä¸€ä¸ªä¸­é—´å±‚ï¼š

1.  **æ‹¦æˆª (Intercept)**: å½“æ™ºèƒ½ä½“æƒ³è¦è¾“å‡ºä»£ç æ—¶ï¼Œå¿…é¡»å…ˆæäº¤ç»™ Blind Auditorã€‚
2.  **éš”ç¦» (Isolate)**: Blind Auditor å¹¶ä¸ç›´æ¥è¿”å›ç»“æœï¼Œè€Œæ˜¯æ³¨å…¥ä¸€æ®µ**å¼ºåˆ¶æ€§ç³»ç»ŸæŒ‡ä»¤**ï¼Œè¿«ä½¿æ™ºèƒ½ä½“æš‚åœå½“å‰äººæ ¼ï¼Œåˆ‡æ¢ä¸º"å†·é¢å®¡è®¡å‘˜" (Ruthless Auditor)ã€‚
3.  **å®¡æŸ¥ (Audit)**: åœ¨è¿™ä¸ªéš”ç¦»çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ™ºèƒ½ä½“å¿…é¡»æ ¹æ®é¢„è®¾çš„ `rules.json` å¯¹åˆšæ‰ç”Ÿæˆçš„ä»£ç è¿›è¡Œé€è¡Œæ‰«æã€‚
4.  **æ”¾è¡Œ (Release)**: åªæœ‰å½“å®¡è®¡è¯„åˆ†è¾¾æ ‡ï¼ˆé»˜è®¤ > 80åˆ†ï¼‰ä¸”æ— ä¸¥é‡ (Critical) é—®é¢˜æ—¶ï¼Œä»£ç æ‰ä¼šè¢«è§£é”å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸ›¡ï¸ é›¶ä¿¡ä»»æ¶æ„**: é»˜è®¤ä¸ä¿¡ä»»æ™ºèƒ½ä½“ç”Ÿæˆçš„åˆç¨¿ï¼Œå¿…é¡»ç»è¿‡å®¡è®¡ã€‚
- **ğŸ’° é›¶é¢å¤–æˆæœ¬**: å¤ç”¨å®¿ä¸» IDE çš„å½“å‰ä¼šè¯æ¨¡å‹ï¼Œæ— éœ€é¢å¤–çš„ API Keyã€‚
- **âš–ï¸ å»åè§æœºåˆ¶**: é€šè¿‡æç¤ºè¯ (Prompt) æ³¨å…¥å¼ºåˆ¶åˆ‡æ¢è§†è§’ï¼Œæ‰“ç ´ç”Ÿæˆçš„æƒ¯æ€§æ€ç»´ã€‚
- **ğŸ“ å¼ºåˆè§„æ¤å…¥**: å°†å›¢é˜Ÿä»£ç è§„èŒƒï¼ˆ`rules.json`ï¼‰ç¡¬æ€§æ¤å…¥ç”Ÿæˆæµç¨‹ï¼Œæ¯”å•çº¯çš„æç¤ºè¯æ›´æœ‰æ•ˆã€‚
- **ğŸ”„ è‡ªåŠ¨ä¿®å¤é—­ç¯**: å®¡è®¡å¤±è´¥æ—¶è‡ªåŠ¨è§¦å‘"ä¿®å¤-é‡æäº¤"å¾ªç¯ï¼Œç›´åˆ°åˆè§„æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

æœ¬é¡¹ç›®ä½¿ç”¨ `uv` è¿›è¡Œä¾èµ–ç®¡ç†ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ pipï¼‰ã€‚

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd blind-auditor

# å®‰è£…ä¾èµ–
uv sync
# æˆ–è€…
pip install -r requirements.txt
```

### 2. é…ç½®å®¡è®¡è§„åˆ™ (`rules.json`)

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæˆ–ç¼–è¾‘ `rules.json`ã€‚è¿™æ˜¯å®¡è®¡å‘˜çš„"æ³•å…¸"ã€‚

```json
{
  "project_name": "MyCoreProject",
  "strict_mode": true,
  "max_retries": 3,
  "rules": [
    {
      "id": "SEC-001",
      "severity": "CRITICAL",
      "description": "ä¸¥ç¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ä»»ä½• API Keyã€å¯†ç æˆ–æ•æ„Ÿ Tokenã€‚",
      "weight": 50
    },
    {
      "id": "PERF-001",
      "severity": "WARNING",
      "description": "é¿å…åœ¨å¾ªç¯ä¸­è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æˆ– IO æ“ä½œã€‚",
      "weight": 15
    },
    {
      "id": "STYLE-001",
      "severity": "PREFERENCE",
      "description": "ä½¿ç”¨ snake_case å‘½åå˜é‡ã€‚",
      "weight": 5
    }
  ]
}
```

**é…ç½®å­—æ®µè¯´æ˜**:
- `severity` (ä¸¥é‡ç¨‹åº¦):
    - `CRITICAL`: è‡´å‘½é”™è¯¯ã€‚åªè¦å‘ç°ä¸€ä¸ªï¼Œå®¡è®¡ç›´æ¥ä¸é€šè¿‡ (Fail)ã€‚æ‰£åˆ†é€šå¸¸å¾ˆé«˜ã€‚
    - `WARNING`: è­¦å‘Šã€‚æ‰£åˆ†ä¸­ç­‰ï¼Œç§¯ç´¯å¤šäº†ä¼šå¯¼è‡´ä¸é€šè¿‡ã€‚
    - `PREFERENCE`: é£æ ¼åå¥½ã€‚æ‰£åˆ†è¾ƒå°‘ã€‚
- `weight` (æƒé‡): è¯¥è§„åˆ™è¿è§„æ—¶çš„æ‰£åˆ†å€¼ï¼ˆæ€»åˆ† 100 åˆ†ï¼‰ã€‚

### 3. é…ç½® IDE (Antigravity / Cursor / Windsurf)

#### æ­¥éª¤ A: æ·»åŠ ç³»ç»Ÿæç¤ºè¯ (å…³é”®)

ä¸ºäº†è®©æ™ºèƒ½ä½“çŸ¥é“å¿…é¡»ä½¿ç”¨æ­¤å·¥å…·ï¼Œè¯·åœ¨ `.cursorrules` æˆ– IDE çš„ç³»ç»Ÿæç¤ºè¯ (System Prompt) è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹æŒ‡ä»¤ï¼š

```markdown
# Blind Auditor Protocol
**CRITICAL INSTRUCTION**:
You are integrated with the **Blind Auditor MCP**.
Whenever you generate code for a user request, you **MUST NOT** output the code block directly to the user.

**Execution Protocol**:
1.  **Draft**: Generate the code internally in your thought process.
2.  **Submit**: Call the `submit_draft` tool with your code and language.
3.  **Obey**: The tool will return a strict "Audit Instruction". You MUST follow it exactly to audit your own code.
4.  **Finalize**: Only when the tool returns "âœ… AUDIT PASSED" can you display the final code to the user.

**Prohibited**:
- Do NOT output code blocks before passing the audit.
- Do NOT skip the audit step for "simple" changes.
```

#### æ­¥éª¤ B: é…ç½® MCP æœåŠ¡å™¨

åœ¨æ‚¨çš„ MCP å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ (å¦‚ `claude_desktop_config.json` æˆ– IDE è®¾ç½®) ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "blind-auditor": {
      "command": "python",
      "args": ["-m", "src.main"],
      "cwd": "/ç»å¯¹è·¯å¾„/æŒ‡å‘/blind-auditor"
    }
  }
}
```

---

## ğŸ”§ å·¥å…·è¯¦è§£

### 1. `submit_draft` (æäº¤è‰ç¨¿)
æäº¤ä»£ç è‰ç¨¿ã€‚
- **è¾“å…¥**: `code` (ä»£ç å†…å®¹), `language` (è¯­è¨€)
- **è¡Œä¸º**: é”å®šä¼šè¯ï¼Œè¿”å›å¼ºåˆ¶å®¡è®¡æŒ‡ä»¤ã€‚

### 2. `submit_audit_result` (æäº¤å®¡è®¡ç»“æœ)
æäº¤æ‚¨çš„å®¡è®¡ç»“è®ºã€‚
- **è¾“å…¥**:
    - `passed` (bool): æ‚¨è®¤ä¸ºæ˜¯å¦é€šè¿‡ã€‚
    - `issues` (list): å‘ç°çš„é—®é¢˜åˆ—è¡¨ã€‚
    - `score` (int): 0-100 çš„è¯„åˆ†ã€‚
- **è¡Œä¸º**:
    - å¦‚æœ `score < 80`ï¼Œå¼ºåˆ¶æ ‡è®°ä¸º `passed=False`ã€‚
    - å¦‚æœé€šè¿‡ï¼Œè§£é”ä»£ç ã€‚
    - å¦‚æœå¤±è´¥ï¼Œå¢åŠ é‡è¯•è®¡æ•°ï¼Œè¦æ±‚æ™ºèƒ½ä½“ä¿®å¤åå†æ¬¡æäº¤ã€‚

### 3. `reset_session` (é‡ç½®ä¼šè¯)
é‡ç½®çŠ¶æ€ï¼Œæ¸…é™¤é‡è¯•è®¡æ•°ã€‚

---

## ğŸ” å·¥ä½œæµå›¾è§£

```mermaid
graph TD
    User["ç”¨æˆ·è¯·æ±‚"] --> Agent
    Agent["æ™ºèƒ½ä½“ç”Ÿæˆè‰ç¨¿"] -->|1. submit_draft| MCP
    MCP -->|2. æ³¨å…¥å®¡è®¡æŒ‡ä»¤| Agent
    
    subgraph Isolation ["Thinking Isolation (æ€ç»´éš”ç¦»å±‚)"]
        Agent -->|3. è‡ªæˆ‘å®¡æŸ¥| Agent
        Agent -->|4. submit_audit_result| MCP
    end
    
    MCP -->|5. åˆ¤å®šç»“æœ| Decision{"é€šè¿‡?"}
    
    Decision -->|å¦ (å‘ç°é—®é¢˜)| Retry["é‡è¯•è®¡æ•° +1"]
    Retry -->|æœªè¶…é™| Fix["æ™ºèƒ½ä½“ä¿®å¤ä»£ç "]
    Fix -->|å†æ¬¡æäº¤| Agent
    
    Decision -->|æ˜¯ (è¯„åˆ† >= 80)| Final["âœ… è¾“å‡ºæœ€ç»ˆä»£ç "]
    
    Retry -->|å·²è¶…é™| Force["âš ï¸ Force Output (With Warning)"]
```

## â“ å¸¸è§é—®é¢˜æ’æŸ¥ (Troubleshooting)

**Q: æ™ºèƒ½ä½“æ€»æ˜¯ç›´æ¥è¾“å‡ºä»£ç ï¼Œä¸è°ƒç”¨å·¥å…·æ€ä¹ˆåŠï¼Ÿ**
A: è¯·æ£€æŸ¥ç³»ç»Ÿæç¤ºè¯ (System Prompt) æ˜¯å¦é…ç½®æ­£ç¡®ã€‚å¿…é¡»æ˜ç¡®å‘Šè¯‰æ™ºèƒ½ä½“"ç¦æ­¢ç›´æ¥è¾“å‡ºä»£ç "ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å¯¹è¯ä¸­æ‰‹åŠ¨æé†’ï¼š"è¯·å…ˆé€šè¿‡ Blind Auditor å®¡è®¡"ã€‚

**Q: ä¸ºä»€ä¹ˆå³ä½¿æˆ‘ç»™ä»£ç æ‰“äº† 100 åˆ†ï¼Œè¿˜æ˜¯æ˜¾ç¤ºå¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ `rules.json` ä¸­æ˜¯å¦æœ‰ `CRITICAL` çº§åˆ«çš„è§„åˆ™è¢«è§¦å‘ï¼ˆè™½ç„¶é€»è¾‘ä¸Šæ™ºèƒ½ä½“åº”è¯¥æ‰£åˆ†ï¼Œä½†æœ‰æ—¶æ™ºèƒ½ä½“ä¼šç”±ç€æ€§å­æ¥ï¼‰ã€‚ç›®å‰çš„é€»è¾‘ä¸»è¦ä¾èµ–æ™ºèƒ½ä½“ä¼ å…¥çš„ `score`ï¼Œä½†å¦‚æœ `passed` ä¼ äº† `True` è€Œ `score < 80`ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶é©³å›ã€‚

**Q: æ”¯æŒå“ªäº›ç¼–ç¨‹è¯­è¨€ï¼Ÿ**
A: ç†è®ºä¸Šæ”¯æŒæ‰€æœ‰è¯­è¨€ã€‚Blind Auditor æœ¬èº«ä¸è§£æä»£ç è¯­æ³•ï¼Œè€Œæ˜¯ä¾èµ–æ™ºèƒ½ä½“çš„ç†è§£èƒ½åŠ›å»åŒ¹é… `rules.json` ä¸­çš„æè¿°ã€‚

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

```bash
# è¿è¡ŒæœåŠ¡å™¨
python -m src.main

# è°ƒè¯•æ¨¡å¼ (è¾“å‡ºåˆ° stderr)
# å¯ä»¥åœ¨ src/main.py ä¸­æŸ¥çœ‹ print è¯­å¥
```

## ğŸ“„ è®¸å¯è¯

MIT License
